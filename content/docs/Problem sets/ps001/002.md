# Exercise 02
{{< hint info >}}
Implement a color mapping application that helps people who are color blind see the colors around them.
{{< /hint >}}

## Presentación

Toda la información, métodos de simulación y corrección fueron obtenidos del artículo: **An Adaptive Fuzzy-Based System to Simulate, Quantify and Compensate Color Blindness** [1]

## Introducción

El daltonismo es un conjunto de patologías de la visión que se caracterizan por una reducción total o parcial de la capacidad de percibir algunos colores o en casos extremos, como la Acromatopsia[2], de todos los colores; a nivel físico, esto se traduce en la imposibilidad o dificultad de alguno de los 3 fotoreceptores del ojo (Rojo para frecuencias de luz bajas, Verde para frecuencias de luz medias y Azules para frecuencias de luz altas) para percibir dichos espectros

Dando una explicación más detallada: Dentro de la retina existen dos tipos de células sensoriales especializadas en captar los estímulos luminosos, los bastones y los conos. Los bastones poseen una alta sensibilidad a la luz acromática mientras que los conos poseen menos sensibilidad a la luz pero son capaces distinguir entre diferentes longitudes de onda. Cómo se mencionó en el primer párrafo, existen tres tipos diferentes de conos en el ojo humano, cad uno especializado en percibir una tonalidad específica (Rojo, Verde y Azul).

Existen 3 clasificaciones distintas de anomalías relacionadas con la percepción del color, las cuales también tienen subclasificaciones
- Tricromacía anomala:
    * Protanomalia: Sensibilidad al color rojo reducida
    * Deuteranomalia: Sensibilidad al color verde reducida
    * Tritanomalia: Sensibilidad a los colores en el rango azul-amarillo reducida.
- Dicromatismo: 
    * Protanopia: Ausencia del cono fotoreceptor de frecuencias bajas (Rojo).
    * Deuteranopia: Ausencia del cono fotoreceptor de frecuencias medias (Verde).
    * Tritanopia: Ausencia del cono fotoreceptor de frecuencias altas (Azul).
- Acromatopsia: Ausencia o sensibilidad reducida en todos los conos fotoreceptores.

La imagen 1 representa gráficamente las bandas expectrales de cada tipo de discapacidad comparada con la visión normal.

![Texto alternativo de la imagen](./content_resources/Color_blindness.svg.png)

**Nota:** Para ver imagen completa, revisar [3]

## Antecendentes

Los métodos clásicos para simular el daltonismo, normalmente se centran en modelos matemáticos que sólo toman en cuenta los casos de dicromatismo, donde el nivel de discapacidad es del 100%, ignorando que los casos reales de daltonismo generalmente son de tricromacía anómala, donde el nivel de discapacidad para determinado color es más orientado a niveles y porcentajes.

El artículo citado se enfoca en revisar y corregir las tonalidades para diferentes grados de Deuteranomalia, Protanomalia y un híbrido entre ambas, para ello, se exploran dos métodos distintos **Mencionarlos**, de los cuales, en el presente trabajo, sólo nos enfocaremos en uno **Insertar el método**

## Consideraciones

Aunque dentro del código final realizado, es posible cambiar el grado de Deuteranomalia y Protanomalia modificando las variables **ad** y **ap**, respectivamente, de su valor inicial 1 (Que representa el 100%) a cualquier porcentaje inferior, para efectos prácticos y de tiempo en cuanto a la presentación del ejercicio, hemos decicido realizar dicha presentación utilizando sólo los valores correspondientes al 100% de discapacidad visual de cada una de las alteraciones, lo que es lo mismo, evaluar los caos de Deuteranopia y Protanopia.

Por lo tanto, en el presente ejercicio sólo se abordarán 4 de los 7 tipos de daltonismo, dando mayor relevancia en el producto final a los dos más extremos, Deuteranopia y Protanopia.

Finalmente cabe hacer la aclaración de que en el documento original, los autores proponen un nuevo caso mezclando ambas discapacidades, la cual también abordaremos en el presente ejercicio como un extra.

## Procedimiento

### Simulación

El algoritmo de simulación que utilizaremos se basa en el modelo LMS (Longwave, Middlewave, Shortwave), ya que este representa los colores con un comportamiento más parecido al de los ojos humanos que el modelo RGB (Red, Green, Blue). Lo primero que harémos al tener nuestra imagen de referencia será convertir sus componentes RGB a componentes LMS, esta conversión se logra mediante una conversión lineal representada de la siguiente forma:

{{< katex display >}} 
\begin{bmatrix} L\\ M\\ S \end{bmatrix} = \begin{bmatrix} 17.8824 & 43.5161 & 4.1194\\ 3.4557 & 27.1554 & 3.8671\\ 0.0300 & 0.1843 & 1.4671 \end{bmatrix} \begin{bmatrix} R\\ G\\ B \end{bmatrix}
{{< /katex >}}

Nuestro segundo paso es convertir los valores LMS de la imagen al dominio de color que ve cada persona con discapacidad visual.

Para Protanopia y Protanomalia, la conversión lineal es:

{{< katex display >}} 
\begin{bmatrix} Lp\\ Mp\\ Sp \end{bmatrix} = \begin{bmatrix} (1-ap) & 2.0234*ap & -2.5258*ap\\ 0 & 1 & 0\\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} L\\ M\\ S \end{bmatrix}
{{< /katex >}}

Y para la Deuteranopia y Deuteranomalia, la conversión lineal es:

{{< katex display >}} 
\begin{bmatrix} Ld\\ Md\\ Sd \end{bmatrix} = \begin{bmatrix} 1 & 0 & 0\\ 0.4942*ad & (1-ad) & 1.2483*ad\\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} L\\ M\\ S \end{bmatrix}
{{< /katex >}}

Finalmente debemos devolver los valores LMS a RGB, lo cual se puede lograr con la siguiente operación:

{{< katex display >}} 
\begin{bmatrix} R\\ G\\ B \end{bmatrix} = \begin{bmatrix} 0.0809 & -0.1305 & 0.1167\\ -0.0102 & 0.0540 & -0.1136\\ -0.0004 & -0.0041 & 0.6935 \end{bmatrix} \begin{bmatrix} L\\ M\\ S \end{bmatrix}
{{< /katex >}}

Y el resultado será una imagen con los colores modificados al espectro que verían las personas con Protanopía y Deuteranopia.

## Solución

{{< p5-iframe sketch="/visualcomputing/sketches/ps001/ex02.js" width="720" height="724" >}}

## Código

## Conclusiones

## Trabajo futuro   

## Referencias
[1] Lee, J., & Santos, W. P. D. (2010). An adaptive fuzzy-based system to simulate, quantify and compensate color blindness. Integrated Computer-aided Engineering, 18(1), 29-40. https://doi.org/10.3233/ica-2011-0356

[2] Avanzada, Á. O. (2020, 5 junio). Acromatopsia, el mundo en blanco y negro. Área Oftalmológica Avanzada. https://areaoftalmologica.com/retina/acromatopsia/

[3] Wikipedia contributors. (2023, 19 marzo). Color blindness. Wikipedia. https://en.wikipedia.org/wiki/Color_blindness